  reportJson Json @default("{}") @map("report_json")

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////////////////////////////////
// ENUMS (match your PostgreSQL enums EXACTLY)
//////////////////////////////////////////////////////

enum Role {
  ADMIN
  MANAGER
  INSPECTOR
  CLIENT

  @@map("role_enum")
}

enum UserStatus {
  ACTIVE
  LOCKED
  DISABLED

  @@map("user_status_enum")
}

enum ClientCategory {
  MINE
  INDUSTRIAL
  CONSTRUCTION

  @@map("client_category_enum")
}

enum ClientStatus {
  ACTIVE
  INACTIVE
  SUSPENDED

  @@map("client_status_enum")
}

enum EquipmentType {
  CRANE
  MOBILE_CRANE
  FORKLIFT
  SERVICE_TRUCK_LIFTING_ATTACHMENTS
  AIR_RECEIVER
  COMPRESSOR
  PRESSURE_VESSEL
  SLINGS_CHAINS_SHACKLES
  HYDRAULIC_JACK
  MECHANICAL_JACK
  SAFETY_HARNESS
  CLAMPS_SHUTTER_CLAMPS
  STEP_LADDERS

  @@map("equipment_type_enum")
}

enum InspectionStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED

  @@map("inspection_status_enum")
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL

  @@map("risk_level_enum")
}

enum NcrCategory {
  MAJOR
  MINOR
  OBSERVATION

  @@map("ncr_category_enum")
}

enum NcrStatus {
  OPEN
  IN_PROGRESS
  CLOSED

  @@map("ncr_status_enum")
}

//////////////////////////////////////////////////////
// MODELS (MAPPED TO YOUR EXISTING TABLES)
//////////////////////////////////////////////////////

model User {
  id                String      @id @map("id")
  name              String      @map("name")
  email             String      @unique @map("email")
  phone             String?     @map("phone")
  passwordHash      String      @map("password_hash")
  role              Role        @default(INSPECTOR) @map("role")
  status            UserStatus  @default(ACTIVE) @map("status")
  failedLoginCount  Int         @default(0) @map("failed_login_count")
  lockUntil         DateTime?   @map("lock_until")
  lastLoginAt       DateTime?   @map("last_login_at")
  lastLoginIp       String?     @map("last_login_ip")
  clientId          String?     @map("client_id")

  createdAt         DateTime    @default(now()) @map("created_at")
  updatedAt         DateTime    @updatedAt @map("updated_at")

  @@map("users")
}

model Client {
  id        String        @id @map("id")
  name      String        @map("name")
  category  ClientCategory @map("category")
  status    ClientStatus   @default(ACTIVE) @map("status")
  notes     String?       @map("notes")

  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")

  @@map("clients")
}

model Equipment {
  id               String        @id @map("id")
  clientId         String        @map("client_id")
  equipmentCode    String        @unique @map("equipment_code")
  type             EquipmentType @map("type")
  serialNumber     String        @map("serial_number")

  manufacturer     String?       @map("manufacturer")
  yearOfManufacture Int?         @map("year_of_manufacture")
  countryOfOrigin  String?       @map("country_of_origin")

  swl              Float?        @map("swl")
  mawp             Float?        @map("mawp")
  designPressure   Float?        @map("design_pressure")
  testPressure     Float?        @map("test_pressure")

  status           String        @default("ACTIVE") @map("status")
  intervalDays     Int?          @map("interval_days")
  nextDueDate      DateTime?     @map("next_due_date")
  lastInspectedAt  DateTime?     @map("last_inspected_at")

  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")

  @@map("equipment")
}

model Inspection {
  id                   String      @id @map("id")
  inspectionCode       String      @unique @map("inspection_code")
  equipmentId          String      @map("equipment_id")
  clientId             String      @map("client_id")
  inspectorId          String      @map("inspector_id")
  type                 String      @map("type")
  datePerformed        DateTime    @map("date_performed")
  findingsText         String?     @map("findings_text")
  nonConformance       Boolean     @default(false) @map("non_conformance")
  certificateIssued    Boolean     @default(false) @map("certificate_issued")
  certificateExpiryDate DateTime?  @map("certificate_expiry_date")
  status               InspectionStatus @default(DRAFT) @map("status")

  createdAt            DateTime    @default(now()) @map("created_at")
  updatedAt            DateTime    @updatedAt @map("updated_at")

  @@map("inspections")
}

model PfmeaItem {
  id            String    @id @map("id")
  inspectionId  String    @map("inspection_id")
  equipmentId   String    @map("equipment_id")
  clientId      String    @map("client_id")

  failureMode   String    @map("failure_mode")
  failureCause  String    @map("failure_cause")
  failureEffect String    @map("failure_effect")

  severity      Int       @map("severity")
  occurrence    Int       @map("occurrence")
  detection     Int       @map("detection")
  rpn           Int       @map("rpn")
  riskLevel     RiskLevel @map("risk_level")

  status        String    @default("OPEN") @map("status")

  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("pfmea_items")
}

model Ncr {
  id          String      @id @map("id")
  ncrCode     String      @unique @map("ncr_code")
  clientId    String      @map("client_id")
  equipmentId String      @map("equipment_id")
  category    NcrCategory @map("category")
  description String      @map("description")
  status      NcrStatus   @default(OPEN) @map("status")

  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  @@map("ncrs")
}
